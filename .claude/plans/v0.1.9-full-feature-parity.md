# tfmcp v0.1.9 ä¼ç”»æ›¸: ãƒ­ãƒ¼ã‚«ãƒ«Terraformå®Œå…¨ç‰¹åŒ–

## è¨­è¨ˆæ€æƒ³

**ãƒ­ãƒ¼ã‚«ãƒ«Terraformé–‹ç™ºä½“é¨“ã®å¾¹åº•å¼·åŒ–**

- HCP/Cloudæ©Ÿèƒ½ã¯ä¸€åˆ‡å«ã¾ãªã„
- terraform CLIã®å…¨ä¸»è¦ã‚³ãƒãƒ³ãƒ‰ã‚’MCPã§æ“ä½œå¯èƒ½ã«
- AIã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆã¨ã®ãƒ­ãƒ¼ã‚«ãƒ«é–‹ç™ºã«æœ€é©åŒ–

---

## æ–°è¦ãƒ„ãƒ¼ãƒ« (10)

### 1. `analyze_plan` - Planè©³ç´°åˆ†æ

**ç›®çš„**: `terraform plan -json`ã‚’è§£æã—ã€æ§‹é€ åŒ–ã•ã‚ŒãŸåˆ†æçµæœã‚’æä¾›

```rust
pub struct AnalyzePlanInput {
    pub include_risk: Option<bool>,  // ãƒªã‚¹ã‚¯è©•ä¾¡ (ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: true)
}
```

**å‡ºåŠ›**:
- å¤‰æ›´ã‚µãƒãƒªãƒ¼ (add/change/destroy)
- ãƒªã‚½ãƒ¼ã‚¹åˆ¥å¤‰æ›´è©³ç´°
- ãƒªã‚¹ã‚¯ã‚¹ã‚³ã‚¢ãƒ»è­¦å‘Šãƒ»æ¨å¥¨äº‹é …
- ä¾å­˜å½±éŸ¿åˆ†æ

---

### 2. `analyze_state` - Stateè©³ç´°åˆ†æ

**ç›®çš„**: `terraform state`ã‚’è§£æã—ã€ãƒªã‚½ãƒ¼ã‚¹çŠ¶æ³ã‚’å¯è¦–åŒ–

```rust
pub struct AnalyzeStateInput {
    pub resource_type: Option<String>,  // ãƒ•ã‚£ãƒ«ã‚¿
    pub detect_drift: Option<bool>,     // ãƒ‰ãƒªãƒ•ãƒˆæ¤œå‡º
}
```

**å‡ºåŠ›**:
- ãƒªã‚½ãƒ¼ã‚¹çµ±è¨ˆ (provideråˆ¥ã€typeåˆ¥)
- ãƒ‰ãƒªãƒ•ãƒˆæ¤œå‡ºçµæœ
- å¥å…¨æ€§ãƒã‚§ãƒƒã‚¯

---

### 3. `terraform_workspace` - ãƒ¯ãƒ¼ã‚¯ã‚¹ãƒšãƒ¼ã‚¹ç®¡ç†

**ç›®çš„**: `terraform workspace`ã‚³ãƒãƒ³ãƒ‰ã‚’MCPã§æ“ä½œ

```rust
pub struct WorkspaceInput {
    pub action: String,        // list, show, new, select, delete
    pub name: Option<String>,  // ãƒ¯ãƒ¼ã‚¯ã‚¹ãƒšãƒ¼ã‚¹å
}
```

---

### 4. `terraform_import` - Importæ”¯æ´

**ç›®çš„**: æ—¢å­˜ãƒªã‚½ãƒ¼ã‚¹ã®ã‚¤ãƒ³ãƒãƒ¼ãƒˆã‚’æ”¯æ´

```rust
pub struct ImportInput {
    pub resource_type: String,
    pub resource_id: String,
    pub name: String,
    pub execute: Option<bool>,  // false=ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼, true=å®Ÿè¡Œ
}
```

---

### 5. `terraform_fmt` - ã‚³ãƒ¼ãƒ‰æ•´å½¢

**ç›®çš„**: `terraform fmt`ã‚’MCPã§æ“ä½œ

```rust
pub struct FmtInput {
    pub check: Option<bool>,  // ãƒã‚§ãƒƒã‚¯ã®ã¿
    pub diff: Option<bool>,   // å·®åˆ†è¡¨ç¤º
    pub file: Option<String>, // ç‰¹å®šãƒ•ã‚¡ã‚¤ãƒ«
}
```

---

### 6. `terraform_graph` - ä¾å­˜ã‚°ãƒ©ãƒ•å‡ºåŠ›

**ç›®çš„**: `terraform graph`ã®å‡ºåŠ›ã‚’æä¾›

```rust
pub struct GraphInput {
    pub format: Option<String>,  // dot, json
    pub type_filter: Option<String>,  // plan, apply
}
```

**å‡ºåŠ›**: DOTå½¢å¼ã¾ãŸã¯JSONå½¢å¼ã®ä¾å­˜ã‚°ãƒ©ãƒ•

---

### 7. `terraform_output` - Outputå€¤å–å¾—

**ç›®çš„**: `terraform output`ã®å€¤ã‚’å–å¾—

```rust
pub struct OutputInput {
    pub name: Option<String>,  // ç‰¹å®šã®outputå (çœç•¥æ™‚ã¯å…¨ã¦)
    pub json: Option<bool>,    // JSONå½¢å¼
}
```

---

### 8. `terraform_taint` - ãƒªã‚½ãƒ¼ã‚¹Taint/Untaint

**ç›®çš„**: ãƒªã‚½ãƒ¼ã‚¹ã®taint/untaintæ“ä½œ

```rust
pub struct TaintInput {
    pub action: String,     // taint, untaint
    pub address: String,    // ãƒªã‚½ãƒ¼ã‚¹ã‚¢ãƒ‰ãƒ¬ã‚¹
}
```

**æ³¨**: Terraform 1.5+ã§ã¯éæ¨å¥¨ã€`-replace`ã‚ªãƒ—ã‚·ãƒ§ãƒ³æ¨å¥¨ã®è­¦å‘Šã‚’å«ã‚ã‚‹

---

### 9. `terraform_refresh` - State Refresh

**ç›®çš„**: `terraform refresh`ç›¸å½“ã®æ“ä½œ

```rust
pub struct RefreshInput {
    pub target: Option<String>,  // ç‰¹å®šãƒªã‚½ãƒ¼ã‚¹
}
```

**å®Ÿè£…**: `terraform apply -refresh-only -auto-approve`

---

### 10. `terraform_providers` - Provideræƒ…å ±

**ç›®çš„**: ä½¿ç”¨ä¸­ã®ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼æƒ…å ±ã‚’å–å¾—

```rust
pub struct ProvidersInput {
    pub lock: Option<bool>,  // lockæƒ…å ±ã‚’å«ã‚ã‚‹
}
```

**å®Ÿè£…**: `terraform providers` + `.terraform.lock.hcl`è§£æ

---

## æ—¢å­˜ãƒ„ãƒ¼ãƒ«æ‹¡å¼µ (3)

### `validate_terraform_detailed` æ‹¡å¼µ

è¿½åŠ ãƒã‚§ãƒƒã‚¯:
- deprecatedå±æ€§è­¦å‘Š
- å‘½åè¦å‰‡ãƒã‚§ãƒƒã‚¯ (snake_caseæ¨å¥¨)
- ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹é•å

### `analyze_terraform` æ‹¡å¼µ

è¿½åŠ åˆ†æ:
- ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç¢ºèª (outdatedæ¤œå‡º)
- Backendè¨­å®šåˆ†æ
- Terraformãƒãƒ¼ã‚¸ãƒ§ãƒ³äº’æ›æ€§

### `get_security_status` æ‹¡å¼µ

è¿½åŠ ã‚¹ã‚­ãƒ£ãƒ³:
- Backendè¨­å®šã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£
- .gitignoreç¢ºèª (tfstate, tfvars)
- Providerèªè¨¼æ–¹æ³•ç¢ºèª

---

## æœ€çµ‚ãƒ„ãƒ¼ãƒ«æ§‹æˆ

### æ—¢å­˜ (21ãƒ„ãƒ¼ãƒ«)
| ã‚«ãƒ†ã‚´ãƒª | ãƒ„ãƒ¼ãƒ« |
|---------|--------|
| Core | list_terraform_resources, get_terraform_plan, apply_terraform, destroy_terraform, init_terraform, validate_terraform, validate_terraform_detailed, get_terraform_state |
| Config | analyze_terraform, set_terraform_directory, get_security_status, analyze_module_health, get_resource_dependency_graph, suggest_module_refactoring |
| Registry | search_terraform_providers, get_provider_info, get_provider_docs, search_terraform_modules, get_module_details, get_latest_module_version, get_latest_provider_version |

### æ–°è¦ (10ãƒ„ãƒ¼ãƒ«)
| ãƒ„ãƒ¼ãƒ« | èª¬æ˜ | ã‚¢ãƒãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ |
|--------|------|---------------|
| `analyze_plan` | Planè©³ç´°åˆ†æãƒ»ãƒªã‚¹ã‚¯è©•ä¾¡ | readOnly |
| `analyze_state` | Stateåˆ†æãƒ»ãƒ‰ãƒªãƒ•ãƒˆæ¤œå‡º | readOnly |
| `terraform_workspace` | ãƒ¯ãƒ¼ã‚¯ã‚¹ãƒšãƒ¼ã‚¹ç®¡ç† | idempotent |
| `terraform_import` | Importæ”¯æ´ | destructive |
| `terraform_fmt` | ã‚³ãƒ¼ãƒ‰æ•´å½¢ | idempotent |
| `terraform_graph` | ä¾å­˜ã‚°ãƒ©ãƒ•å‡ºåŠ› | readOnly |
| `terraform_output` | Outputå€¤å–å¾— | readOnly |
| `terraform_taint` | Taint/Untaint | destructive |
| `terraform_refresh` | State Refresh | destructive |
| `terraform_providers` | Provideræƒ…å ± | readOnly |

### åˆè¨ˆ: 31ãƒ„ãƒ¼ãƒ«

---

## ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

```
src/terraform/
â”œâ”€â”€ service.rs           # æ—¢å­˜ (æ‹¡å¼µ)
â”œâ”€â”€ analyzer.rs          # æ—¢å­˜ (æ‹¡å¼µ)
â”œâ”€â”€ plan_analyzer.rs     # æ–°è¦: Plan JSONè§£æ
â”œâ”€â”€ state_analyzer.rs    # æ–°è¦: Stateè§£æ
â”œâ”€â”€ workspace.rs         # æ–°è¦: Workspaceæ“ä½œ
â”œâ”€â”€ import_helper.rs     # æ–°è¦: Importæ”¯æ´
â”œâ”€â”€ fmt.rs               # æ–°è¦: Fmtæ“ä½œ
â”œâ”€â”€ graph.rs             # æ–°è¦: Graphå‡ºåŠ›
â”œâ”€â”€ output.rs            # æ–°è¦: Outputå–å¾—
â”œâ”€â”€ taint.rs             # æ–°è¦: Taint/Untaint
â”œâ”€â”€ refresh.rs           # æ–°è¦: Refreshæ“ä½œ
â””â”€â”€ providers.rs         # æ–°è¦: Provideræƒ…å ±
```

---

## README.md æ›´æ–°å†…å®¹

```markdown
## ğŸ‰ Latest Release

The latest version of tfmcp (v0.1.9) is now available on Crates.io!

### ğŸ†• What's New in v0.1.9
- **ğŸ“Š Plan Analysis**: Structured plan analysis with risk scoring and recommendations
- **ğŸ” State Analysis**: Deep state inspection with drift detection
- **ğŸ“ Workspace Management**: Full terraform workspace support
- **ğŸ“¥ Import Helper**: Guided resource import with config generation
- **âœ¨ Code Formatting**: terraform fmt integration
- **ğŸ”— Dependency Graph**: terraform graph visualization
- **ğŸ“¤ Output Management**: terraform output access
- **ğŸ·ï¸ Taint/Untaint**: Resource taint management
- **ğŸ”„ State Refresh**: Explicit state refresh
- **ğŸ“¦ Provider Info**: Detailed provider information

## MCP Tools

### Terraform Operations (31 tools)

#### Core Operations
| Tool | Description |
|------|-------------|
| `init_terraform` | Initialize Terraform project |
| `get_terraform_plan` | Execute terraform plan |
| `analyze_plan` | **NEW** Analyze plan with risk scoring |
| `apply_terraform` | Apply configuration |
| `destroy_terraform` | Destroy resources |
| `validate_terraform` | Validate configuration |
| `validate_terraform_detailed` | Detailed validation with guidelines |
| `get_terraform_state` | Get current state |
| `analyze_state` | **NEW** Analyze state with drift detection |

#### Workspace & State
| Tool | Description |
|------|-------------|
| `terraform_workspace` | **NEW** Manage workspaces |
| `terraform_import` | **NEW** Import existing resources |
| `terraform_taint` | **NEW** Taint/untaint resources |
| `terraform_refresh` | **NEW** Refresh state |

#### Code & Output
| Tool | Description |
|------|-------------|
| `terraform_fmt` | **NEW** Format code |
| `terraform_graph` | **NEW** Generate dependency graph |
| `terraform_output` | **NEW** Get output values |
| `terraform_providers` | **NEW** Get provider info |

#### Analysis & Security
| Tool | Description |
|------|-------------|
| `analyze_terraform` | Analyze configuration |
| `analyze_module_health` | Module health metrics |
| `get_resource_dependency_graph` | Resource dependencies |
| `suggest_module_refactoring` | Refactoring suggestions |
| `get_security_status` | Security scan with secret detection |

#### Registry (unchanged)
| Tool | Description |
|------|-------------|
| `search_terraform_providers` | Search providers |
| `get_provider_info` | Provider details |
| `get_provider_docs` | Provider documentation |
| `search_terraform_modules` | Search modules |
| `get_module_details` | Module details |
| `get_latest_module_version` | Latest module version |
| `get_latest_provider_version` | Latest provider version |
```

---

## è¦‹ç©ã‚‚ã‚Š

| é …ç›® | æ•°å€¤ |
|------|------|
| æ–°è¦ãƒ„ãƒ¼ãƒ« | 10 |
| æ—¢å­˜æ‹¡å¼µ | 3 |
| åˆè¨ˆãƒ„ãƒ¼ãƒ« | 31 |
| æ–°è¦ãƒ•ã‚¡ã‚¤ãƒ« | 10 |
| è¿½åŠ è¡Œæ•° | ~2,000è¡Œ |
| ãƒ†ã‚¹ãƒˆè¿½åŠ  | ~25ãƒ†ã‚¹ãƒˆ |

---

## å®Ÿè£…å„ªå…ˆé †

1. **Plan/Stateåˆ†æ** - analyze_plan, analyze_state
2. **Workspaceç®¡ç†** - terraform_workspace
3. **Import/Fmt** - terraform_import, terraform_fmt
4. **Graph/Output** - terraform_graph, terraform_output
5. **Taint/Refresh** - terraform_taint, terraform_refresh
6. **Provideræƒ…å ±** - terraform_providers
7. **æ—¢å­˜æ‹¡å¼µ** - validate/analyze/securityæ‹¡å¼µ
8. **READMEæ›´æ–°** - ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæ•´å‚™

---

## é™¤å¤–ã—ãŸæ©Ÿèƒ½

| æ©Ÿèƒ½ | ç†ç”± |
|------|------|
| HCPãƒ¯ãƒ¼ã‚¯ã‚¹ãƒšãƒ¼ã‚¹ | ã‚¯ãƒ©ã‚¦ãƒ‰ä¾å­˜ |
| Sentinelãƒãƒªã‚·ãƒ¼ | HCPå°‚ç”¨ |
| Private Registry | HCPå°‚ç”¨ |
| Runç®¡ç† | HCPå°‚ç”¨ |
| å¤‰æ•°ã‚»ãƒƒãƒˆ | HCPå°‚ç”¨ |
